function [ poly ] = imfit( img, fig )
%UNTITLED Summary of this function goes here
%   Detailed explanation goes here

[h, w] = size(img);

% Pre-processing: take only one point per line
img_clean = ones(h,w);
for i = 1:h
    row = img(i,:);
    passed = 0;
    for j = 1:w
        if passed
            break;
        end
        if ~row(j)
            passed = 1;
            img_clean(i,j) = 0;
        end
        
    end
end

img_clean_bis = ones(h,w);
for j = 1:w
    col = img_clean(:,j);
    passed = 0;
    for i = 1:h
        if passed
            break;
        end
        if ~col(i)
            passed = 1;
            img_clean_bis(i,j) = 0;
        end
        
    end
end

% All the indexes with the points on the curve
I = find(img_clean_bis==0);
[x, y] = ind2sub(I, size(img_clean_bis));
% x = w-x;
y = h-y;

poly = polyfit(x,y,2)

if nargin >= 2
    figure();
    imshow(img_clean_bis);
    hold on;
    xlim([1 w]); % Get the right scaling for the function
    ylim([1 h]);
    xval = linspace(1, w, w);
    yval = h-polyval(poly, xval);
    plot(x, yval, 'r');
    hold off;
    axis on;
end

end

